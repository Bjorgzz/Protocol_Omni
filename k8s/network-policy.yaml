# Protocol OMNI v15.0 - Network Policies
# Zone B (agents) can ONLY reach Zone A (inference) + memory services
# Prevents lateral movement if agent is compromised
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: zone-b-egress-restrict
  namespace: agents
spec:
  podSelector:
    matchLabels:
      zone: hands
  policyTypes:
  - Egress
  - Ingress
  egress:
  - to:
    - ipBlock:
        cidr: 192.168.3.10/32
    ports:
    - protocol: TCP
      port: 8000
    - protocol: TCP
      port: 8002
    - protocol: TCP
      port: 8003
    - protocol: TCP
      port: 8050
    - protocol: TCP
      port: 8283
    - protocol: TCP
      port: 6333
    - protocol: TCP
      port: 7687
  - to:
    - namespaceSelector:
        matchLabels:
          kubernetes.io/metadata.name: kube-system
    ports:
    - protocol: UDP
      port: 53
  ingress:
  - from:
    - ipBlock:
        cidr: 192.168.3.0/24
    ports:
    - protocol: TCP
      port: 8080
    - protocol: TCP
      port: 8011
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: zone-a-ingress-allow
  namespace: inference
spec:
  podSelector:
    matchLabels:
      zone: brain
  policyTypes:
  - Ingress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          zone: hands
    ports:
    - protocol: TCP
      port: 8000
    - protocol: TCP
      port: 8002
    - protocol: TCP
      port: 8003
  - from:
    - ipBlock:
        cidr: 192.168.3.0/24
    ports:
    - protocol: TCP
      port: 8000
    - protocol: TCP
      port: 8002
    - protocol: TCP
      port: 8003
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-deny-all
  namespace: agents
spec:
  podSelector: {}
  policyTypes:
  - Ingress
  - Egress
